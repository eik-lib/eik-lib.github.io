"use strict";(self.webpackChunkeik=self.webpackChunkeik||[]).push([[739],{5347:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>o,toc:()=>l});var s=n(4848),i=n(8453);const r={id:"server",title:"Server",sidebar_label:"Server"},a=void 0,o={id:"server",title:"Server",description:"The Eik server is a Node.js application distributed as the @eik/service NPM package. It aims to be runnable as a service out of the box but still be flexible and customizable enough to suite a wide range of infrastructures needs.",source:"@site/docs/server.md",sourceDirName:".",slug:"/server",permalink:"/docs/server",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{id:"server",title:"Server",sidebar_label:"Server"},sidebar:"mainSidebar",previous:{title:"Build Tool Plugins",permalink:"/docs/mapping_plugins"},next:{title:"Programatic API",permalink:"/docs/server_api"}},c={},l=[{value:"Production setup",id:"production-setup",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:["The Eik server is a Node.js application distributed as the ",(0,s.jsx)(t.a,{href:"https://www.npmjs.com/package/@eik/service",children:(0,s.jsx)(t.code,{children:"@eik/service"})})," NPM package. It aims to be runnable as a service out of the box but still be flexible and customizable enough to suite a wide range of infrastructures needs."]}),"\n",(0,s.jsxs)(t.p,{children:["The only requirement to run the Eik server is ",(0,s.jsx)(t.a,{href:"https://nodejs.org/",children:"Node.js 18.x or newer"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["The fastest way to test a running instance of the Eik server is by using ",(0,s.jsx)(t.code,{children:"npx"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:"npx @eik/service\n"})}),"\n",(0,s.jsxs)(t.p,{children:["This will install the latest Eik server and start it at ",(0,s.jsx)(t.a,{href:"http://localhost:4001",children:"http://localhost:4001"}),". By default all uploaded assets will be stored in a sub-folder of the OS temp directory (NOTE: they will be lost when the OS clears the temp directory). The default authentication key is ",(0,s.jsx)(t.code,{children:"change_me"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"production-setup",children:"Production setup"}),"\n",(0,s.jsxs)(t.p,{children:["The Eik service builds on ",(0,s.jsx)(t.a,{href:"https://www.fastify.io/",children:"Fastify"})," and is in addition to being a standalone server also exposed as a Fastify plugin. This makes it flexible and easy to set up a custom Eik service."]}),"\n",(0,s.jsx)(t.p,{children:"Example of a custom server using the sink for Google Cloud Storage and extending the HTTP API with custom ready checks:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:'import fastify from "fastify";\nimport Service from "@eik/service";\nimport Sink from "@eik/sink-gcs";\n\n// Set up the Google Cloud Storage sink\n// https://github.com/eik-lib/sink-gcs?tab=readme-ov-file#example\nconst sink = new Sink({\n  credentials: {\n    client_email: "a@email.address",\n    private_key: "[ ...snip... ]",\n    projectId: "myProject",\n  },\n});\n\n// Set up the Eik service as a plugin\nconst service = new Service({ customSink: sink });\n\n// Set up Fastify\nconst app = fastify({\n  ignoreTrailingSlash: true,\n  modifyCoreObjects: false,\n  trustProxy: true,\n});\n\n// Register the Eik service in Fastify\napp.register(service.api());\n\n// Append custom HTTP ready checks\napp.get("/_/health", (request, reply) => {\n  reply.send("ok");\n});\n\napp.get("/_/ready", (request, reply) => {\n  reply.send("ok");\n});\n\n// Start the server\nconst run = async () => {\n  await service.health();\n  await app.listen(\n    service.config.get("http.port"),\n    service.config.get("http.address"),\n  );\n};\nrun();\n'})})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var s=n(6540);const i={},r=s.createContext(i);function a(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);