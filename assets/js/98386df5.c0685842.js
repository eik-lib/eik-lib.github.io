"use strict";(self.webpackChunkeik=self.webpackChunkeik||[]).push([[3643],{3905:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return c}});var i=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=i.createContext({}),s=function(e){var n=i.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=s(e.components);return i.createElement(p.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},m=i.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=s(t),c=r,b=m["".concat(p,".").concat(c)]||m[c]||d[c]||a;return t?i.createElement(b,o(o({ref:n},u),{},{components:t})):i.createElement(b,o({ref:n},u))}));function c(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,o=new Array(a);o[0]=m;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var s=2;s<a;s++)o[s]=t[s];return i.createElement.apply(null,o)}return i.createElement.apply(null,t)}m.displayName="MDXCreateElement"},5546:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return l},contentTitle:function(){return p},metadata:function(){return s},toc:function(){return u},default:function(){return m}});var i=t(7462),r=t(3366),a=(t(7294),t(3905)),o=["components"],l={id:"mapping_bundling",title:"Bundling",sidebar_label:"Bundling"},p=void 0,s={unversionedId:"mapping_bundling",id:"mapping_bundling",isDocsHomePage:!1,title:"Bundling",description:"Tools like Microbundle], [Create React App, [Vuex] and [Next.js] are popular for one primary reason: nobody likes configuring bundlers. We just want to write our app code and move on with our day.",source:"@site/docs/mapping_bundling.md",sourceDirName:".",slug:"/mapping_bundling",permalink:"/docs/mapping_bundling",tags:[],version:"current",frontMatter:{id:"mapping_bundling",title:"Bundling",sidebar_label:"Bundling"},sidebar:"mainSidebar",previous:{title:"Build Tool Plugins",permalink:"/docs/mapping_plugins"},next:{title:"Installation",permalink:"/docs/client_installation"}},u=[{value:"Why we forked microbundle",id:"why-we-forked-microbundle",children:[],level:2},{value:"Using @eik/microbundle",id:"using-eikmicrobundle",children:[],level:2},{value:"Bundling applications",id:"bundling-applications",children:[],level:2},{value:"Bundling libraries",id:"bundling-libraries",children:[],level:2}],d={toc:u};function m(e){var n=e.components,t=(0,r.Z)(e,o);return(0,a.kt)("wrapper",(0,i.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Tools like ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/developit/microbundle#readme"},"Microbundle"),", ",(0,a.kt)("a",{parentName:"p",href:"https://create-react-app.dev/"},"Create React App"),", ",(0,a.kt)("a",{parentName:"p",href:"https://vuex.vuejs.org/"},"Vuex")," and ",(0,a.kt)("a",{parentName:"p",href:"https://nextjs.org/"},"Next.js")," are popular for one primary reason: nobody likes configuring bundlers. We just want to write our app code and move on with our day."),(0,a.kt)("h2",{id:"why-we-forked-microbundle"},"Why we forked ",(0,a.kt)("a",{parentName:"h2",href:"https://github.com/developit/microbundle#readme"},"microbundle")),(0,a.kt)("p",null,"We love ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/developit/microbundle#readme"},"microbundle")," <3. But it doesn't support import maps. We ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/eik-lib/microbundle#readme"},"forked it")," to add that functionality. We're currently experimenting and discovering the optimal way of generating import mapped esm bundles as well as IE11 fallback bundles. The long term goal is to land contributions to ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/developit/microbundle#readme"},"microbundle")," so we can one day delete our ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/eik-lib/microbundle#readme"},"fork"),"."),(0,a.kt)("h2",{id:"using-eikmicrobundle"},"Using ",(0,a.kt)("a",{parentName:"h2",href:"https://github.com/eik-lib/microbundle#readme"},"@eik/microbundle")),(0,a.kt)("p",null,"Installing from npm:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"npm install @eik/microbundle\n")),(0,a.kt)("p",null,"Since we intend to one day delete our fork, we use the same name for our binary command as ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/developit/microbundle#readme"},"microbundle"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"microbundle --help\n")),(0,a.kt)("p",null,"Beyond implementing the rollup plugin for eik import mapping, there are some differences in our fork from the original. Pay attention to the readme for eik microbundle for up to date information on those."),(0,a.kt)("h2",{id:"bundling-applications"},"Bundling applications"),(0,a.kt)("p",null,'In this guide "applications" are projects with a ',(0,a.kt)("inlineCode",{parentName:"p"},"package.json")," that publishes assets to eik, but not to npm.\nFor these use cases we can use the simple setup, given this ",(0,a.kt)("inlineCode",{parentName:"p"},"package.json"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "scripts": {\n    "build": "npm run build:esm && npm run build:ie11",\n    "build:esm": "microbundle index.js -o dist/esm.js --no-pkg-main --import-map auto -f modern",\n    "build:ie11": "microbundle index.js -o dist/ie11.js --no-pkg-main --external none -f iife"\n  },\n  "dependencies": {\n    "@eik/microbundle": "^0.2.10"\n  },\n  "devDependencies": {\n    "@eik/cli": "^1.4.3"\n  }\n}\n')),(0,a.kt)("p",null,"And an ",(0,a.kt)("inlineCode",{parentName:"p"},"eik.json")," like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "version": "1.0.0",\n  "name": "my-pack",\n  "files": {\n    "/": "./dist/*"\n  },\n  "import-map": ["..."]\n}\n')),(0,a.kt)("p",null,"You'll have ",(0,a.kt)("inlineCode",{parentName:"p"},"esm.js"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"esm.css")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"ie11.js")," generated for you when you run ",(0,a.kt)("inlineCode",{parentName:"p"},"npm run build")," and then run ",(0,a.kt)("inlineCode",{parentName:"p"},"eik version && eik publish"),". Ready to be used like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<link\n  href="http://assets.myserver.com/pkg/my-pack/1.0.0/esm.css"\n  rel="stylesheet"\n/>\n<script\n  src="http://assets.myserver.com/pkg/my-pack/1.0.0/esm.js"\n  type="module"\n><\/script>\n<script\n  src="http://assets.myserver.com/pkg/my-pack/1.0.0/ie11.js"\n  nomodule\n><\/script>\n')),(0,a.kt)("h2",{id:"bundling-libraries"},"Bundling libraries"),(0,a.kt)("p",null,"Libraries that are published to both eik and npm need should use this setup (this example uses TypeScript):"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "main": "dist/index.js",\n  "module": "dist/index.esm.js",\n  "files": ["dist/"],\n  "scripts": {\n    "prebuild": "npx rimraf dist/** dist-eik/**",\n    "build": "npm run build:dist && npm run build:eik-esm && npm run build:eik-ie11",\n    "build:dist": "microbundle src/index.ts -o ./dist/index.js -f cjs && microbundle src/index.ts -o ./dist/index.esm.js -f esm --no-pkg-main",\n    "build:eik-esm": "microbundle src/index.ts -o ./dist-eik/esm.js --no-pkg-main --import-map auto -f modern",\n    "build:eik-ie11": "microbundle src/index.ts -o ./dist-eik/ie11.js --no-pkg-main --external none -f iife"\n    "publish:eik": "eik login -k $EIK_SERVER_KEY && eik publish"\n  },\n  "typings": "dist/index.d.ts",\n  "devDependencies": {\n    "@eik/cli": "1.4.3",\n    "@eik/microbundle": "^0.2.10",\n    "rimraf": "^3.0.2"\n  }\n}\n')),(0,a.kt)("p",null,"What's important to note here is the usage of ",(0,a.kt)("inlineCode",{parentName:"p"},"--no-pkg-main")," to bypass the filename template feature of microbundle, which works sligtly differently in our fork and might change in the future. Using ",(0,a.kt)("inlineCode",{parentName:"p"},"--no-pkg-main")," ensures it'll always work."))}m.isMDXComponent=!0}}]);