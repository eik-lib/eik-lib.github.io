"use strict";(self.webpackChunkeik=self.webpackChunkeik||[]).push([[3861],{3905:function(e,t,r){r.d(t,{Zo:function(){return m},kt:function(){return d}});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var o=n.createContext({}),p=function(e){var t=n.useContext(o),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},m=function(e){var t=p(e.components);return n.createElement(o.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),u=p(r),d=a,k=u["".concat(o,".").concat(d)]||u[d]||c[d]||i;return r?n.createElement(k,s(s({ref:t},m),{},{components:r})):n.createElement(k,s({ref:t},m))}));function d(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=r.length,s=new Array(i);s[0]=u;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l.mdxType="string"==typeof e?e:a,s[1]=l;for(var p=2;p<i;p++)s[p]=r[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}u.displayName="MDXCreateElement"},7750:function(e,t,r){r.r(t),r.d(t,{frontMatter:function(){return l},contentTitle:function(){return o},metadata:function(){return p},toc:function(){return m},default:function(){return u}});var n=r(7462),a=r(3366),i=(r(7294),r(3905)),s=["components"],l={id:"server_metrics",title:"Eik server - Metrics",sidebar_label:"Metrics"},o=void 0,p={unversionedId:"server_metrics",id:"server_metrics",title:"Eik server - Metrics",description:"The Eik server exposes a metric stream which emits internal metrics",source:"@site/docs/server_metrics.md",sourceDirName:".",slug:"/server_metrics",permalink:"/docs/server_metrics",tags:[],version:"current",frontMatter:{id:"server_metrics",title:"Eik server - Metrics",sidebar_label:"Metrics"},sidebar:"mainSidebar",previous:{title:"File structure",permalink:"/docs/server_file_structure"},next:{title:"Overview",permalink:"/docs/ci"}},m=[{value:"Usage",id:"usage",children:[],level:2},{value:"Metrics",id:"metrics",children:[],level:2}],c={toc:m};function u(e){var t=e.components,r=(0,a.Z)(e,s);return(0,i.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"The Eik server exposes a ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/metrics-js/client"},"metric stream")," which emits internal metrics\non the server. These metrics are intended to give numbers on how the server as an application is behaving and\nperforming and is an important tool in the toolbox for monitoring the servers health status. These metrics do\nnot provide statistics on assets uploaded to the asset server."),(0,i.kt)("p",null,"The metrics the server provides are not bound to any particular metric system so it's possible to provide the metrics to\nany monitoring system as preferred. The metric stream emits a set of generic metric objects that can be altered and\npiped as desired."),(0,i.kt)("p",null,"Please see ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/metrics-js/client"},"@metrics/client")," for examples of how to consume these metrics in\nyour preferred monitoring system."),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"@eik/service")," module exposes a ",(0,i.kt)("inlineCode",{parentName:"p"},".metric")," property. This property holds a plain Node.js object stream which\nemits the metrics as objects on the stream."),(0,i.kt)("p",null,"This stream can be piped into a metrics consumer or any other Node.js writable / transform stream for further\nprocessing."),(0,i.kt)("p",null,"Example of metrics being piped into a prometheus consumer:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const MetricsConsumer = require('@metrics/prometheus-consumer');\nconst prometheus = require('prom-client');\nconst Service = require('@eik/service');\nconst fastify = require('fastify');\n\nconst service = new Service();\n\nconst metricsConsumer = new MetricsConsumer({\n    client: prometheus,\n});\n\nservice.metrics.pipe(metricsConsumer);\n\nconst app = fastify();\napp.register(service.api());\n\napp.get('/_/metrics', (request, reply) => {\n    reply.type(metricsConsumer.registry.contentType);\n    reply.send(metricsConsumer.registry.metrics());\n});\n\nconst run = async () => {\n    await app.listen(8080, '0.0.0.0');\n}\nrun();\n")),(0,i.kt)("h2",{id:"metrics"},"Metrics"),(0,i.kt)("p",null,"Each metric provided by the server has a unique ",(0,i.kt)("inlineCode",{parentName:"p"},"name")," and a ",(0,i.kt)("inlineCode",{parentName:"p"},"type")," defining what type (counter, histogram, etc) of\nmetric it is."),(0,i.kt)("p",null,"The server exposes these metrics:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Name"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"eik_core_auth_post_handler"),(0,i.kt)("td",{parentName:"tr",align:null},"histogram"),(0,i.kt)("td",{parentName:"tr",align:null},"Time taken in a ",(0,i.kt)("a",{parentName:"td",href:"/docs/server_rest_api#login"},"login")," method")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"eik_core_pkg_get_handler"),(0,i.kt)("td",{parentName:"tr",align:null},"histogram"),(0,i.kt)("td",{parentName:"tr",align:null},"Time taken in a ",(0,i.kt)("a",{parentName:"td",href:"/docs/server_rest_api#public-package-url"},"public package")," method")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"eik_core_pkg_log_handler"),(0,i.kt)("td",{parentName:"tr",align:null},"histogram"),(0,i.kt)("td",{parentName:"tr",align:null},"Time taken in a ",(0,i.kt)("a",{parentName:"td",href:"/docs/server_rest_api#package-version-overview"},"package version overview")," method")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"eik_core_pkg_put_handler"),(0,i.kt)("td",{parentName:"tr",align:null},"histogram"),(0,i.kt)("td",{parentName:"tr",align:null},"Time taken in a ",(0,i.kt)("a",{parentName:"td",href:"/docs/server_rest_api#upload-a-package"},"upload package")," method")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"eik_core_versions_get_handler"),(0,i.kt)("td",{parentName:"tr",align:null},"histogram"),(0,i.kt)("td",{parentName:"tr",align:null},"Time taken in a ",(0,i.kt)("a",{parentName:"td",href:"/docs/server_rest_api#latest-package-versions"},"latest package versions")," method")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"eik_core_alias_get_handler"),(0,i.kt)("td",{parentName:"tr",align:null},"histogram"),(0,i.kt)("td",{parentName:"tr",align:null},"Time taken in a ",(0,i.kt)("a",{parentName:"td",href:"/docs/server_rest_api#public-alias-url"},"public alias")," method")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"eik_core_alias_put_handler"),(0,i.kt)("td",{parentName:"tr",align:null},"histogram"),(0,i.kt)("td",{parentName:"tr",align:null},"Time taken in a ",(0,i.kt)("a",{parentName:"td",href:"/docs/server_rest_api#create-alias"},"create alias")," method")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"eik_core_alias_post_handler"),(0,i.kt)("td",{parentName:"tr",align:null},"histogram"),(0,i.kt)("td",{parentName:"tr",align:null},"Time taken in a ",(0,i.kt)("a",{parentName:"td",href:"/docs/server_rest_api#update-alias"},"update alias")," method")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"eik_core_alias_del_handler"),(0,i.kt)("td",{parentName:"tr",align:null},"histogram"),(0,i.kt)("td",{parentName:"tr",align:null},"Time taken in a ",(0,i.kt)("a",{parentName:"td",href:"/docs/server_rest_api#delete-alias"},"delete alias")," method")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"eik_core_map_get_handler"),(0,i.kt)("td",{parentName:"tr",align:null},"histogram"),(0,i.kt)("td",{parentName:"tr",align:null},"Time taken in a ",(0,i.kt)("a",{parentName:"td",href:"/docs/server_rest_api#public-import-maps-url"},"public import maps")," method")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"eik_core_map_put_handler"),(0,i.kt)("td",{parentName:"tr",align:null},"histogram"),(0,i.kt)("td",{parentName:"tr",align:null},"Time taken in a ",(0,i.kt)("a",{parentName:"td",href:"/docs/server_rest_api#upload-an-import-map"},"upload import maps")," method")))))}u.isMDXComponent=!0}}]);