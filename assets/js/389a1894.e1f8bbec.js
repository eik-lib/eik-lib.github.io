"use strict";(self.webpackChunkeik=self.webpackChunkeik||[]).push([[736],{4570:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>c,frontMatter:()=>l,metadata:()=>r,toc:()=>d});var s=i(4848),t=i(8453);const l={id:"client_putting_it_all_together",title:"Putting It All Together",sidebar_label:"Putting It All Together"},o=void 0,r={id:"client_putting_it_all_together",title:"Putting It All Together",description:"Aliases can be used with application packages, NPM packages and import maps to make it easier to update versions without the need to update and redeploy applications.",source:"@site/docs/client_putting_it_all_together.md",sourceDirName:".",slug:"/client_putting_it_all_together",permalink:"/docs/client_putting_it_all_together",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{id:"client_putting_it_all_together",title:"Putting It All Together",sidebar_label:"Putting It All Together"},sidebar:"mainSidebar",previous:{title:"Aliases",permalink:"/docs/client_aliases"},next:{title:"Server",permalink:"/docs/server"}},a={},d=[{value:"Setting up the @podium/browser dependency",id:"setting-up-the-podiumbrowser-dependency",level:2},{value:"Create a new Node.js project",id:"create-a-new-nodejs-project",level:3},{value:"Add @podium/browser as a dependency",id:"add-podiumbrowser-as-a-dependency",level:3},{value:"Add Eik config to <code>package.json</code>",id:"add-eik-config-to-packagejson",level:3},{value:"Run a build to bundle up @podium/browser into a single file",id:"run-a-build-to-bundle-up-podiumbrowser-into-a-single-file",level:3},{value:"Publishing",id:"publishing",level:3},{value:"Alias NPM package",id:"alias-npm-package",level:3},{value:"Creating an import map to use in the application",id:"creating-an-import-map-to-use-in-the-application",level:2},{value:"Alias import map",id:"alias-import-map",level:3},{value:"Setting up the application",id:"setting-up-the-application",level:2},{value:"Create an eik.json file",id:"create-an-eikjson-file",level:3},{value:"Bundle local code",id:"bundle-local-code",level:3},{value:"Publish bundled code to the Eik server",id:"publish-bundled-code-to-the-eik-server",level:3},{value:"Consuming an application bundle",id:"consuming-an-application-bundle",level:2}];function p(e){const n={code:"code",em:"em",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Aliases can be used with application packages, NPM packages and import maps to make it easier to update versions without the need to update and redeploy applications."}),"\n",(0,s.jsxs)(n.p,{children:["In the following example, the ",(0,s.jsx)(n.code,{children:"@podium/browser"})," package will be set up as a dependency that multiple page bundles can include without the module being inlined (and therefore duplicated)."]}),"\n",(0,s.jsx)(n.h2,{id:"setting-up-the-podiumbrowser-dependency",children:"Setting up the @podium/browser dependency"}),"\n",(0,s.jsxs)(n.p,{children:["The first step is to create a version of the module that you are happy publishing to Eik. Since ",(0,s.jsx)(n.code,{children:"@podium/browser"})," is already using ESM, we won't need to transpile the source code at all but we will still want to bundle up all the projects files into a single file before publishing the module to the Eik server."]}),"\n",(0,s.jsx)(n.p,{children:"To do this we:"}),"\n",(0,s.jsx)(n.h3,{id:"create-a-new-nodejs-project",children:"Create a new Node.js project"}),"\n",(0,s.jsx)(n.p,{children:"Create a new directory for the project"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"mkdir podium-browser\ncd podium-browser\n"})}),"\n",(0,s.jsx)(n.p,{children:"Initialise the Node app"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"npm init -f\n"})}),"\n",(0,s.jsx)(n.h3,{id:"add-podiumbrowser-as-a-dependency",children:"Add @podium/browser as a dependency"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"npm install @podium/browser\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"add-eik-config-to-packagejson",children:["Add Eik config to ",(0,s.jsx)(n.code,{children:"package.json"})]}),"\n",(0,s.jsxs)(n.p,{children:["Set the ",(0,s.jsx)(n.code,{children:"package.json"})," name and version to match ",(0,s.jsx)(n.code,{children:"@podium/browser"})," and add some Eik configuration under the ",(0,s.jsx)(n.code,{children:"eik"})," key."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "name": "@podium/browser",\n    "version": "1.2.1",\n    "eik": {\n        "server": "https://myeikserver.com",\n        "files": "./dist",\n        "type": "npm"\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"run-a-build-to-bundle-up-podiumbrowser-into-a-single-file",children:"Run a build to bundle up @podium/browser into a single file"}),"\n",(0,s.jsxs)(n.p,{children:["We can use Rollup to bundle up the code from ",(0,s.jsx)(n.code,{children:"@podium/browser"})," into a single file and place it into the ",(0,s.jsx)(n.code,{children:"dist"})," directory ready for upload like so:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"npx rollup -f es -o ./dist/index.js ./node_modules/@podium/browser/src/index.js\n"})}),"\n",(0,s.jsxs)(n.p,{children:["N.B. We ensure that ESM is preserved with the ",(0,s.jsx)(n.code,{children:"-f es"})," flag."]}),"\n",(0,s.jsx)(n.h3,{id:"publishing",children:"Publishing"}),"\n",(0,s.jsx)(n.p,{children:"Run:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"eik publish\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Once complete, ",(0,s.jsx)(n.code,{children:"@podium/browser"})," should then be available on the Eik server at:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"https://myeikserver.com/npm/@podium/browser/1.2.1/index.js\n"})}),"\n",(0,s.jsx)(n.h3,{id:"alias-npm-package",children:"Alias NPM package"}),"\n",(0,s.jsxs)(n.p,{children:["Next, we need to create an alias pointing to the exact version of ",(0,s.jsx)(n.code,{children:"@podium/browser"})," that we published to Eik. In this case, ",(0,s.jsx)(n.code,{children:"1.2.1"})," will be aliased to ",(0,s.jsx)(n.code,{children:"v1"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"eik npm-alias @podium/browser 1.2.1 1\n"})}),"\n",(0,s.jsxs)(n.p,{children:["An alias for ",(0,s.jsx)(n.code,{children:"@podium/browser"})," should now be available at ",(0,s.jsx)(n.code,{children:"https://myeikserver.com/npm/@podium/browser/v1/index.js"})]}),"\n",(0,s.jsx)(n.h2,{id:"creating-an-import-map-to-use-in-the-application",children:"Creating an import map to use in the application"}),"\n",(0,s.jsxs)(n.p,{children:["Create an import map JSON file that uses the ",(0,s.jsx)(n.code,{children:"podium/browser"})," alias ",(0,s.jsx)(n.code,{children:"v1"})," rather than the exact version so that if we need to update the module, it wont be necessary to update the import map."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "imports": {\n        "@podium/browser": "https://myeikserver.com/npm/@podium/browser/v1/index.js"\n    }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"And then publish the import map to the Eik server"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"eik map my-map 1.0.0 ./import-map.json\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The import map should now be available at ",(0,s.jsx)(n.code,{children:"https://myeikserver.com/map/my-map/1.0.0"})]}),"\n",(0,s.jsx)(n.h3,{id:"alias-import-map",children:"Alias import map"}),"\n",(0,s.jsx)(n.p,{children:"Create an alias of the import map for use when packaging application code."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"eik map-alias my-map 1.0.0 1\n"})}),"\n",(0,s.jsxs)(n.p,{children:["An alias for the import map ",(0,s.jsx)(n.code,{children:"my-map"})," version ",(0,s.jsx)(n.code,{children:"1.0.0"})," should now be available at ",(0,s.jsx)(n.code,{children:"https://myeikserver.com/map/my-map/v1"})]}),"\n",(0,s.jsx)(n.h2,{id:"setting-up-the-application",children:"Setting up the application"}),"\n",(0,s.jsx)(n.h3,{id:"create-an-eikjson-file",children:"Create an eik.json file"}),"\n",(0,s.jsxs)(n.p,{children:["Create an ",(0,s.jsx)(n.code,{children:"eik.json"})," file describing the apps asset setup and enter the import map alias URL so that plugins can use it to replace bare imports with Eik URLs."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "server": "https://myeikserver.com",\n    "name": "my-app",\n    "version": "1.0.0",\n    "files": "./dist",\n    "import-map": "https://myeikserver.com/map/my-map/v1"\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"bundle-local-code",children:"Bundle local code"}),"\n",(0,s.jsx)(n.p,{children:"This assumes you are already familiar with using Rollup and the instructions here only show how to augment an existing setup."}),"\n",(0,s.jsxs)(n.p,{children:["Add ",(0,s.jsx)(n.code,{children:"@eik/rollup-plugin"})," to your rollup config file"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"npm install -D @eik/rollup-plugin\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"import resolve from '@rollup/plugin-node-resolve';\nimport commonjs from '@rollup/plugin-commonjs';\nimport babel from '@rollup/plugin-babel';\nimport eik from '@eik/rollup-plugin';\n\nexport default {\n    input: './src/index.js',\n    output: {\n        file: './dist/index.js',\n        format: 'es',\n        sourcemap: true,\n    },\n    plugins: [\n        eik(),\n        resolve(),\n        commonjs(),\n        babel(),\n    ],\n};\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.em,{children:"n.b."})," The ",(0,s.jsx)(n.code,{children:"files"})," field in ",(0,s.jsx)(n.code,{children:"eik.json"})," is set to read ",(0,s.jsx)(n.code,{children:"./dist/index.js"})," which is produced by the rollup build.\nAlso note that you are not required to use Rollup at all. You could use Esbuild or Webpack for example."]}),"\n",(0,s.jsx)(n.h3,{id:"publish-bundled-code-to-the-eik-server",children:"Publish bundled code to the Eik server"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"eik publish\n"})}),"\n",(0,s.jsx)(n.h2,{id:"consuming-an-application-bundle",children:"Consuming an application bundle"}),"\n",(0,s.jsx)(n.p,{children:"The application bundle can be included in an HTML page using a script tag like so"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<script src="https://myeikserver.com/pkg/my-app/1.0.0/index.js" type="module" defer><\/script>\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Any bare references to ",(0,s.jsx)(n.code,{children:"@podium/browser"})," will have been replaced with absolute URLs to the Eik server."]})]})}function c(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>r});var s=i(6540);const t={},l=s.createContext(t);function o(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);